<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Creación de responsables</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  {% load static %}
  <script src="{% static 'clearFds.js' %}"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
  <style>
    .input-icon-img {
      width: 26px;
      /* Tamaño personalizado */
      height: 26px;
      /* Tamaño personalizado */
    }

    .input-with-icon {
      display: flex;
      align-items: center;
    }

    .input-with-icon .input-icon {
      margin-right: 8px;
    }





  </style>
</head>

<body>

  <div class="container mt-5">
    <h1>Crear Responsables</h1>
    <div class="row">

      <form method="post" class="row g-3" id="responsable_form" name="form">
        {% csrf_token %}

        <div class="col-md-3">
          <div class="col-md-12">
            <label class="form-label">Nombres y apellidos:</label>
            <input type="text" class="form-control" placeholder="Nombre y apellidos" name="name" required id="name"
              title="Mínimo dos palabras">
          </div>


          

          <div class="col-md-12">
            <label class="form-label"><br>Teléfono:</label>
            <div id="phone-input-wrapper" class="input-with-icon">
              <span class="input-icon">
                <img src="{% static 'Images/phone.png' %}" alt="Icono de teléfono" class="input-icon-img">
              </span>
              <input type="tel" class="form-control" placeholder="Teléfono" name="phone" required id="phone"
                minlength="7" maxlength="12" title="Ingresa un número de teléfono válido entre 7 y 12 dígitos">
            </div>
          </div>
        



        <input type="hidden" id="prefix" name="prefix">




        <div class="col-md-12">
          <label class="form-label"><br>Correo Electrónico:</label>
          <div class="input-with-icon">
            <span class="input-icon">
              <img src="{% static 'Images/email.png' %}" alt="Icono de correo electrónico" class="input-icon-img">
            </span>
            <input type="email" class="form-control" placeholder="Email" name="mail" required id="mail">
          </div>
        </div>
    </div>

    <div class="col-md-12">
      <input type="submit" value="Crear Responsable" class="btn btn-primary">
    </div>
    </form>
    {% if messages %}
    {% for message in messages %}
    <script>
      if (window.opener) {
        // Si es una ventana emergente, hacer algo y luego cerrar la ventana
        window.onload = function () {

          alert('{{ message }}');

          //Obtener nombre despues del mensaje
          mensaje = "{{ message }}";
          var manager = mensaje.split(": ")[1];


          //retardo para que los valores se escriban despues de recargar la página
          setTimeout(function () {
            window.opener.document.querySelector("#manager").value = manager;

            window.close();

          }, 500);
        };

      } else {
        window.onload = function () {

          alert('{{ message }}');

        };
      }


    </script>
    {% endfor %}
    {% endif %}
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
  <script>
    const input = document.querySelector("#phone");
    const prefixInput = document.querySelector('input[name="prefix"]');

    const iti = window.intlTelInput(input, {
      preferredCountries: ["co"],
      separateDialCode: true,
      utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
    });

    // Evento change para actualizar el valor de la input prefix
    input.addEventListener("change", function () {
      const selectedCountryData = iti.getSelectedCountryData();
      Prefijo = selectedCountryData.dialCode;
      Prefijo = "+" + Prefijo
      prefixInput.value = Prefijo;
    });
  </script>
</body>

</html>