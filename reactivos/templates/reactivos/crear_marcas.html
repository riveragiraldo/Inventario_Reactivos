<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Creación de marca emergente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    {% load static %}
    <script src="{% static 'clearFds.js' %}"></script> 
  </head>
  <body>

    <div class="container mt-5">
      <h1>Crear Marca Emergente</h1>
        <div class="row">
            
                <form method="post" class="row g-3" id="marca_form" name="form">
                    {% csrf_token %}
                   
                    <div class="col-md-5">
                        <label class="form-label">Nombre de la marca:</label>
                        <input type="text" class="form-control" placeholder="Nombre marca" name="name" required id="name">
                    </div>
                    
                    <div class="col-md-9">
                        <input type="submit" value="Crear Marca" class="btn btn-primary">
                    </div>
                </form>
                {% if messages %}
                {% for message in messages %}
                <script>
                  window.onload = function () {
                    
                    alert('{{ message }}');
                    
                    //Obtener Id despues del mensaje
                    mensaje = "{{ message }}";
                    var marca_id = mensaje.split(": ")[1];
                    
                    // Obtener los valores de los elementos necesarios de la ventana padre
                    var name = window.opener.document.getElementById("name").value;
                    var code = window.opener.document.getElementById("code").value;
                    var cas = window.opener.document.getElementById("cas").value;
                    var reference = window.opener.document.getElementById("reference").value;
                    var is_liquid = window.opener.document.getElementById("is_liquid").value;
                    var weight = window.opener.document.getElementById("weight").value;
                    var unit = window.opener.document.getElementById("unit").value;
                    var location = window.opener.document.getElementById("location").value;
                    var destination = window.opener.document.getElementById("destination").value;
                    var manager = window.opener.document.getElementById("manager").value;
                    var observations = window.opener.document.getElementById("observations").value;
                    var cantidad = window.opener.document.querySelector('label[for="weight"]');
                    cantidad=cantidad.textContent

                    // Recargar la página padre
                    window.opener.location.replace(window.opener.location.href);

                    //retardo para que los valores se escriban despues de recargar la página
                    setTimeout(function () {
                        // Acceder a la ventana padre y actualizar los valores

                        window.opener.document.querySelector("#name").value = name;
                        window.opener.document.querySelector("#code").value = code;
                        window.opener.document.querySelector("#cas").value = cas;
                        window.opener.document.querySelector("#reference").value = reference;
                        window.opener.document.querySelector("#is_liquid").value = is_liquid;
                        window.opener.document.querySelector("#weight").value = weight;
                        window.opener.document.querySelector("#unit").value = unit;
                        window.opener.document.querySelector("#location").value = location;
                        window.opener.document.querySelector("#manager").value = manager;
                        window.opener.document.querySelector("#observations").innerHTML = observations;

                        //Actualizar Etiqueta Cantidad
                        var label = document.querySelector('.form-label[for="weight"]'); // selecciona la etiqueta con el id "weight"
                        label.innerHTML = cantidad;

                        //Actualiza Select destination
                        var destination_new = window.opener.document.querySelector("#destination");
                        destination_new.value = destination;
                        destination_new.setAttribute("selected", true);

                        //Actualiza Select trademark
                        var marca_new = window.opener.document.querySelector("#trademark");
                        marca_new.value = marca_id;
                        marca_new.setAttribute("selected", true);

                        window.close();

                    }, 500);
                };
                </script>
                {% endfor %}
                {% endif %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  </body>
</html>